<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.js"></script>
<script type="text/javascript" src="http://cdn.jsdelivr.net/jquery.cookie/1.3/jquery.cookie.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsay4E0YcVz-1-OdkSnAoTBn7Axtqbw7Y"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript"> google.charts.load('current', {'packages':['table', 'gauge']}); </script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<!-- JavaScript/jQuery code starts here. -->   

<script>
    "use strict";

	var serverdata
    //
    // This event fires when the document's DOM is loaded (which may be some 
    // time before the images, etc. are loaded).
    //
    $(document).ready(function () {

    	// Set the hook for submitting the file upload form.
    	document.getElementById("runfile").onchange = function () {
    		var file = $('#runfile').get(0).files[0];
    		//var file = runfile.files[0]; // grab the first (and only) file in the list
    		var fileExt = $("input#runfile").val();
    		fileExt = fileExt.slice(fileExt.length - 3, fileExt.length);
    		fileExt = fileExt.toLowerCase();
			sendFile(file, fileExt);
    	}

    	// Set the hook for submitting the file upload form.
    	document.getElementById("runfilemenu").onchange = function () {
    		var file = $('#runfilemenu').get(0).files[0];
    		//var file = runfile.files[0]; // grab the first (and only) file in the list
    		var fileExt = $("input#runfilemenu").val();
    		fileExt = fileExt.slice(fileExt.length - 3, fileExt.length);
    		fileExt = fileExt.toLowerCase();
			sendFile(file, fileExt);
    	}


    });


	//
	//
	//
	function sendFile (file, fileExt) {
	  		// Check file extension.
    		if (fileExt != "fit" && fileExt != "tcx") {
				var notification = document.querySelector('.mdl-js-snackbar');
				notification.MaterialSnackbar.showSnackbar(
				{
					message: 'Error: filetype is:' + fileExt + '. FitPlot only supports .fit and .tcx files at this time.'
				}
				);
    			return false;
    		} // end if file not the right type

    		var formData = new FormData();
    		formData.append('file', file)
    		$.ajax({
    			url: "/",
    			type: "post",
    			data: formData,
    			processData: false,
    			contentType: false,
    			success: function () {
					var notification = document.querySelector('.mdl-js-snackbar');
					notification.MaterialSnackbar.showSnackbar(
					{
						message: 'File load completed!.'
					}
					);
    				requestData();
    			},
    			error: function () {
					var notification = document.querySelector('.mdl-js-snackbar');
					var data = {
					message: 'Sorry! Error uploading file.',
					actionHandler: function(event) {sendFile(file, fileExt);},
					actionText: 'Retry',
					timeout: 10000
					};
					notification.MaterialSnackbar.showSnackbar(data);
									}
								});
	}

    //
    // This event fires after the window loads.
    //
	$(window).load(function () {
    	// Set the checkboxes based on the cookie when the window loads.
    	$("input.mdl-checkbox__input").each(function () {
    		var mycookie = $.cookie($(this).attr('id'));
    		if (mycookie && mycookie == "true") {
    			$(this).prop('checked', mycookie);
    		}
    	});

    	// Set the textbox values based on the cookie when the window loads.
    	$("input.mdl-textfield__input").each(function () {
    		var mycookie = $.cookie($(this).attr('id'));
    		if (mycookie != null) {
    			$(this).prop('value', mycookie);
    		}
    	});

    	// Set the hook for storing/updating the cookie when the checkbox changes.
    	$("input.mdl-checkbox__input").change(function () {
    		$.cookie($(this).attr("id"), $(this).prop('checked'), {
    			path: '/',
    			expires: 365
    		});
    	});

    	// Set the hook for storing/updating the cookie when the textbox value changes.
    	$("input.mdl-textfield__input").change(function () {
    		$.cookie($(this).attr("id"), $(this).prop('value'), {
    			path: '/',
    			expires: 365
    		});
    	});
    });

    //
    // Request data from the server.
    //
    function requestData() {
		var useEnglish = !$("#usemetric").is(':checked')
		var racedist = $("#racedist")[0].value
		var racehours = $("#racehours")[0].value
		var racemins = $("#racemins")[0].value
		var racesecs = $("#racesecs")[0].value
    	$.ajax({
    		url: '/getplot',
    		data: {
    			toEnglish: useEnglish,
				racedist: racedist,
				racehours: racehours,
				racemins: racemins,
				racesecs: racesecs,
    		},
    		dataType: "json",
    		success: function (returneddata) {
    			// Save a global copy.
				serverdata = returneddata;
    		},
    		cache: false
    	});
    };

	//
	// Summarize tab has been selected.
	//
	$(function () {
		$('.sum-tab').click(function () {
			createSummary(serverdata);
   			createLaps(serverdata);
		})
	});

	//
	// Visualize tab has been selected.
	//
	$(function () {
		$('.vis-tab').click(function () {
			visualize();
		})
	});

	//
	// Plot the graph and map using the current data.
	//
	function visualize() {
		var showPace = $("#pacechk").is(':checked')
		var showElev = $("#elevchk").is(':checked')
		var showCad = $("#cadchk").is(':checked')
		requestData();
		setTimeout(function(){ 
			var marker = createMap(serverdata);
			createGraph(serverdata, showPace, showElev, showCad, marker);
		}, 1000);
	}

	//
	// Analyze tab has been selected.
	//
	$(function () {
		$('.ana-tab').click(function () {
			analyze();
		})
	});

	//
	// Rerun the analysis and display.
	//
	function analyze() {
		requestData();
		// Since asynchronous must give the server time to recalculate before
		// plotting.
		setTimeout(function(){ 
			createRace(serverdata);
			createScore(serverdata);
		}, 1000);
	}

    //
    // Create the summary using the DOM.
    //
    function createSummary(p) {
    	// Write summary information.
    	$("#over_div").empty();
    	var summary = document.getElementById('over_div')
    	summary.innerHTML += '</br>Congrats on your run!</br>';
    	summary.innerHTML += '</br><b>Distance: </b> ' + p.TotalDistance;
    	summary.innerHTML += '</br><b>Time: </b> ' + p.ElapsedTime;
    	summary.innerHTML += '</br><b>Pace: </b> ' + p.TotalPace;
    	summary.innerHTML += '</br><b>Start:</b> ' + p.StartDateStamp;
    	summary.innerHTML += '</br><b>End: </b> ' + p.EndDateStamp;
    	summary.innerHTML += '</br><b>Total Energy: </b>' + p.TotalCal;
    	summary.innerHTML += '</br><b>Average Power: </b>' + p.AvgPower;
    	summary.innerHTML += '</br><b>Device Name: </b>' + p.DeviceName;
    	summary.innerHTML += '</br><b>Device Product ID: </b>' + p.DeviceProdID;
    	summary.innerHTML += '</br><b>Device Serial Number: </b>' + p.DeviceUnitID;
    }

    //
    // Create the map using the Google map API.
    //
    function createMap(p) {
    	// Create a new map.
    	var map = new google.maps.Map(document.getElementById('mapDiv'), {
    		zoom: 15,
    		center: p.Latlongs[0],
    		mapTypeId: google.maps.MapTypeId.TERRAIN
    	});
    	// Create a path line.  
    	var runPath = new google.maps.Polyline({
    		path: p.Latlongs,
    		geodesic: true,
    		strokeColor: '#ff0000',
    	});
    	runPath.setMap(map);
    	// Center map based on path.
    	var bound = new google.maps.LatLngBounds();
    	for (var i = 0; i < p.Latlongs.length; i++) {
    		bound.extend(new google.maps.LatLng(p.Latlongs[i].lat, p.Latlongs[i].lng));
    	}
		map.setCenter(bound.getCenter());
		map.fitBounds(bound);

    	// Add a marker.
    	var marker = new google.maps.Marker({
    		position: p.Latlongs[0],
    		title: "Here we are!"
    	});
    	marker.setMap(map);

		// Force a refresh!
		setTimeout(function () {
			google.maps.event.trigger(map, 'resize');
			//map.setCenter(mapOptions.center);
		}, 500);

    	// Return the marker object for use with graph.
    	return marker;
    }


    //
    // Create the run graph using the Plotly API.
    //
    function createGraph(p, showPace, showElev, showCad, marker) {
    	// Boilerplate for fluid layout.
    	var d3 = Plotly.d3;
		var WIDTH_IN_PERCENT_OF_PARENT = 99; 
		// window.innerHeight should be set based on style settings for the "card".
    	var HEIGHT_IN_PERCENT_OF_PARENT = Math.floor(window.innerHeight/screen.height * 100);
    	var gd3 = d3.select("#plotlyDiv")
    		.style({
    			width: WIDTH_IN_PERCENT_OF_PARENT + '%',
    			'margin-left': (100 - WIDTH_IN_PERCENT_OF_PARENT) / 2 + '%',
    			height: HEIGHT_IN_PERCENT_OF_PARENT + 'vh',
    		});
    	var gd = gd3.node();

    	// Clean out the drawing surface.
    	Plotly.purge(plotlyDiv);

    	//Create a Plotly chart.
    	var trace1 = {
    		x: p.DispDistance,
    		y: p.DispPace,
    		name: p.Y0Name,
    		type: 'scatter',
    		yaxis: 'y',
    		line: {
    			color: "#1f77b4"
    		},
    		visible: showPace,
    	};

    	var trace2 = {
    		x: p.DispDistance,
    		y: p.DispAltitude,
    		name: p.Y1Name,
    		yaxis: 'y2',
    		type: 'scatter',
    		line: {
    			color: "#ff7f0e"
    		},
    		visible: showElev,
    	};

    	var trace3 = {
    		x: p.DispDistance,
    		y: p.DispCadence,
    		name: p.Y2Name,
    		yaxis: 'y3',
    		type: 'scatter',
    		line: {
    			color: "#4DAF4A"
    		},
    		visible: showCad,
    	};


    	var data = [trace1, trace2, trace3];

    	var yaxisTitle = showPace ? p.Y0Name : '';
    	var yaxis2Title = showElev ? p.Y1Name : '';
    	var yaxis3Title = showCad ? p.Y2Name : '';

    	var layout = {
    		showlegend: false,
    		//	  hovermode: 'closest',
    		title: p.Titletext,
    		xaxis: {
    			title: p.XName,
    			domain: [0.0, 0.90],
    			titlefont: {
    				size: 14
    			},
    			tickfont: {
    				size: 14
    			},
    			gridcolor: '#bdbdbd',
    			gridwidth: 1,
				hoverformat: '.2f',
    		},
    		//	  legend: {
    		//	    orientation: "h",
    		//	  },


    		yaxis: {
    			title: yaxisTitle,
    			titlefont: {
    				color: '#1f77b4',
    				size: 14
    			},
    			tickfont: {
    				color: '#1f77b4',
    				size: 14
    			},
    			autorange: 'reversed',
    			anchor: 'x',
    			side: 'left',
    			position: 0,
    			showgrid: showPace,
    			showticklabels: showPace,
    			zeroline: false,
				hoverformat: '.2f',
    		},

    		yaxis2: {
    			title: yaxis2Title,
    			titlefont: {
    				color: '#ff7f0e',
    				size: 14
    			},
    			tickfont: {
    				color: '#ff7f0e',
    				size: 14
    			},
    			overlaying: 'y',
    			anchor: 'x',
    			side: 'right',
    			showgrid: showElev,
    			showticklabels: showElev,
    			zeroline: false,
				hoverformat: '.0f',

    		},
    		yaxis3: {
    			title: yaxis3Title,
    			titlefont: {
    				color: '#4DAF4A',
    				size: 14
    			},
    			tickfont: {
    				color: '#4DAF4A',
    				size: 14
    			},
    			anchor: 'free',
    			overlaying: 'y',
    			side: 'right',
    			position: 1,
    			showgrid: showCad,
    			showticklabels: showCad,
    			zeroline: false,
				hoverformat: '.0f',
    		},
    		font: {
    			family: "Roboto, sans-serif",
    			size: 0,
    		},
			annotations: [{
				xref: 'paper',
				yref: 'paper',
				x: 0.5,
				xanchor: 'center',
				y: 1.0,
				yanchor: 'bottom',
				text: '',
				showarrow: false,
				font: {
				family: 'Roboto, sans-serif',
				size: 14,
				color: '#1f77b4'
				},
//				bgcolor: '#1f77b4',
				opacity: 0.8
				}]
    	};
    	Plotly.plot(gd, data, layout);
		Plotly.Plots.resize(gd);

    	// Handle resizing.
    	window.onresize = function () {
    		Plotly.Plots.resize(gd);
    	};

    	// Move the map marker when over a point in the graph.
    	var myPlot = document.getElementById('plotlyDiv');
    	myPlot.on('plotly_hover', function (data) {
    		var pts = '';
    		for (var i = 0; i < data.points.length; i++) {
    			pts = 'x = ' + data.points[i].x + '\ny = ' +
    				data.points[i].y.toPrecision(4) + '\n\n';

    			var distances = document.getElementById('plotlyDiv').data[0].x
    			for (var j = 0; j < distances.length; j++) {
    				if (distances[j] > data.points[i].x) {
    					break;
    				}
    			}
    			var moveLatlong = p.Latlongs[j - 1];
    			marker.setPosition(moveLatlong);
    		}
    	});
		// Calculate 'local' averages on zoom.
		myPlot.on('plotly_relayout', function(eventdata){
				if ((eventdata.hasOwnProperty('xaxis.range[0]')) && (eventdata.hasOwnProperty('xaxis.range[1]'))) {
					var xmin = eventdata['xaxis.range[0]'];
					var xmax = eventdata['xaxis.range[1]'];
					var plot = document.getElementById('plotlyDiv')
					var pace = plot.data[0];
					var elevation = plot.data[1];
					var cadence = plot.data[2];
					var sum = 0.0;
					var count = 0;
					for (var i = 0; i < pace.x.length; i++) {
						if (pace.x[i] >= xmin && pace.x[i] <= xmax) {
							sum += pace.y[i]
							count += 1
						}
					}
					var avgPace = sum/count;
					sum = 0.0;
					count = 0;
					for (var i = 0; i < elevation.x.length; i++) {
						if (elevation.x[i] >= xmin && elevation.x[i] <= xmax) {
							sum += elevation.y[i]
							count += 1
						}
					}
					var avgElevation = sum/count;
					sum = 0.0;
					count = 0;
					for (var i = 0; i < cadence.x.length; i++) {
						if (cadence.x[i] >= xmin && cadence.x[i] <= xmax) {
							sum += cadence.y[i]
							count += 1
						}
					}
					var avgCadence = sum/count;
					var myAnnotation = 'Segment average: ' +  ' ';
					if (showPace) { myAnnotation += p.Y0Name + '=' + avgPace.toPrecision(4) + ' ' }
					if (showElev) { myAnnotation += p.Y1Name + '=' + avgElevation.toPrecision(4) + ' ' }
					if (showCad) { myAnnotation += p.Y2Name + '=' + avgCadence.toPrecision(4) + ' ' }
					// Is this the best way to get the annotation???
					var annotation = plot.attributes[1].ownerElement.layout.annotations[0]
					annotation.text = myAnnotation
					Plotly.redraw(plot)
				}
				// Clear it out if unzooming
				if (eventdata.hasOwnProperty('xaxis.autorange')) {
					var plot = document.getElementById('plotlyDiv')
					var annotation = plot.attributes[1].ownerElement.layout.annotations[0]
					annotation.text = ''
					Plotly.redraw(plot)
				}
			});

    }

    //
    // Create the lap table using the Google Charts API.
    //
    function createLaps(p) {
    	// Add lap values to the data table.	
    	var data = new google.visualization.DataTable();
    	data.addColumn('number', p.C0Str);
    	data.addColumn('number', p.C1Str);
    	data.addColumn('string', p.C2Str);
    	data.addColumn('string', p.C3Str);
    	data.addColumn('number', p.C4Str);
    	var cellStyle = {
    		style: 'font-family: Roboto, serif; font-size: 12px; opacity: 0.; text-align:center; vertical-align:middle'
    	}
    	for (var i = 0; i < p.LapDist.length; i++) {
    		data.addRows([
    			[i + 1, p.LapDist[i], p.LapPace[i], p.LapTime[i], p.LapCal[i]],
    		]);
    		data.setProperties(i, 0, cellStyle);
    		data.setProperties(i, 1, cellStyle);
    		data.setProperties(i, 2, cellStyle);
    		data.setProperties(i, 3, cellStyle);
    		data.setProperties(i, 4, cellStyle);
    	}
    	var table = new google.visualization.Table(document.getElementById('table_div'));
    	table.draw(data, {
    		showRowNumber: false,
    		width: '100%',
    		height: '100%',
    		allowHtml: true
    	});
    }

    //
    // Create the race prediction table using the Google Charts API.
    //
    function createRace(p) {
    	// Add predicted race values to the prediction table.
    	var preddata = new google.visualization.DataTable();
    	preddata.addColumn('string', 'Race');
    	preddata.addColumn('string', 'Time (hh:mm:ss)');
    	var cellStyle = {
    		style: 'font-family: Roboto, serif; font-size: 12px; opacity: 0.; text-align:center; vertical-align:middle'
    	}
    	var row = 0;
    	for (var k in p.PredictedTimes) {
    		if (p.PredictedTimes.hasOwnProperty(k)) {
    			preddata.addRows([
    				[k, p.PredictedTimes[k], ]
    			]);
    		}
    		preddata.setProperties(row, 0, cellStyle);
    		preddata.setProperties(row, 1, cellStyle);
    		row = row + 1
    	}
    	var predtable = new google.visualization.Table(document.getElementById('prediction_div'));
    	predtable.draw(preddata, {
    		showRowNumber: false,
    		width: '100%',
    		height: '100%',
    		allowHtml: true
    	});

    }

	function createScore(p) {

    	$("#run_support").empty();
    	var rs = document.getElementById('run_support')
    	rs.innerHTML += '</br><b>VDOT: </b> ' + p.VDOT.toFixed(1) + ' ml/kg/min';
    	rs.innerHTML += '</br><b>VO2max: </b> ' + p.VO2max.toFixed(1) + ' ml/kg/min';

        var data = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['%VO2max', p.RunScore],
        ]);

        var options = {
          width: 200, height: 200,
          redFrom: 90, redTo: 100,
          yellowFrom:75, yellowTo: 90,
          greenFrom: 0, greenTo: 75,
          minorTicks: 5
        };

        var chart = new google.visualization.Gauge(document.getElementById('run_score_div'));

        chart.draw(data, options);
	}

    //
    // Request data from the server.
    //
    function requestExit() {
		if (confirm("Close Window?")) {
			$.ajax({
				url: '/stop',
				cache: false
			});
			// Give the server 3 seconds - a reasonable amount of time to see the message before leaving.
			setTimeout( function() {close(); }, 3000)
		}
    };


</script>

<!-- Styling -->
<style>#runfile { display: none }</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.blue-green.min.css" />
<script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script>
<style>

.mdl-layout__header-row {
  height: 10vh;
  width: 100vw;
}

.mdl-layout__tab-bar {
  height: 10vh;
  width: 100vw;
}

.mdl-mini-footer {
  height: 5vh;
  width: 100vw;
}

.mdl-card {
  height: 75vh;
  width: 100vw;
}

.google-table {
  height: 65vh;
}

.google-map {
  height: 65vh;
}

.plotlyDiv {
  height: 65vh;
  width: 99%;
  margin-left: 0.5%
}
.mdl-card__subtitle-text {
  padding: 5px;
}

</style>

</head>
  <body>

<!-- Simple header with fixed tabs. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header
            mdl-layout--fixed-tabs">
  <header class="mdl-layout__header">

	<div class="mdl-layout__header-row">
		<!-- Title -->
		<span class="mdl-layout-title">FitPlot</span>
		<!-- Add spacer, to align navigation to the right -->
		<div class="mdl-layout-spacer"></div>
		<!-- Navigation. We hide it in small screens. -->
		<nav class="mdl-navigation mdl-layout--large-screen-only">
				<label id="runbtn" for="runfile" class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--accent ">
					<i class="material-icons">add</i>
					<input type="file" name="runfile" id="runfile"> 
				</label>
				<span for="runbtn" class="mdl-tooltip">Load a Garmin .fit or .tcx file</span>

		</nav>
		</div>

    <!-- Tabs -->
	<div class="mdl-layout__tab-bar mdl-js-ripple-effect">
		<a href="#fixed-tab-2" class="mdl-layout__tab vis-tab">Visualize</a>
		<a href="#fixed-tab-1" class="mdl-layout__tab sum-tab">Summarize</a>
		<a href="#fixed-tab-3" class="mdl-layout__tab ana-tab">Analyze</a>
	</div>
  </header>

	<div class="mdl-layout__drawer">
	<span class="mdl-layout-title">FITPLOT</span>
	<nav class="mdl-navigation">
	<label id="runbtnmenu" for="runfilemenu" class="mdl-button mdl-js-button mdl-button--accent">
		<input type="file" name="runfilemenu" id="runfilemenu"> 
	</label>
	<span for="runbtnmenu" class="mdl-tooltip">Load a Garmin .fit or .tcx file</span>
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" target="_blank" href="/static/help.html" >Help</a>
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" target="_blank" href="/static/help.html#license">License</a>
		<button type="button" id="drawer-exit" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" onclick="requestExit()">Exit</button>
	</nav>
</div>

	<div aria-live="assertive" aria-atomic="true" aria-relevant="text" class="mdl-snackbar mdl-js-snackbar">
		<div class="mdl-snackbar__text"></div>
		<button type="button" class="mdl-snackbar__action"></button>
	</div>

  <main class="mdl-layout__content">
	<section class="mdl-layout__tab-panel" id="fixed-tab-1">
		<div class="page-content"><!-- Your content goes here -->

		<div class="mdl-grid">
			<!-- Summary -->
			<div class="mdl-card mdl-cell--6-col-desktop mdl-cell--4-col-tablet mdl-shadow--3dp">
				<div class="mdl-card__title">
					<h2 class="mdl-card__title-text">Summary</h2>
				</div>
				<div id="over_div" class="mdl-card__supporting-text">
				</div>      
			</div>
			<!-- Laps/splits -->
			<div class="mdl-card mdl-cell--6-col-desktop mdl-cell--4-col-tablet mdl-shadow--3dp">
				<div class="mdl-card__title">
					<h2 class="mdl-card__title-text">Laps/Splits</h2>
				</div>
				<div class="google-table" id="table_div">
				</div>
			</div>
		</div>

		</div>

		<footer class="mdl-mini-footer">
		<div class="mdl-mini-footer__left-section">
			<div class="mdl-logo">
			More Information
			</div>
			<ul class="mdl-mini-footer__link-list">
			<li><a target="_blank" href="/static/help.html">Help</a></li>
			<li><a target="_blank" href="/static/help.html#license">License</a></li>
			</ul>
		</div>
		<div class="mdl-mini-footer__right-section">
		<!--
			<button class="mdl-mini-footer__social-btn"></button>
			<button class="mdl-mini-footer__social-btn"></button>
			<button class="mdl-mini-footer__social-btn"></button>
		-->
		</div>
		</footer>

	</section>
	<section class="mdl-layout__tab-panel is-active" id="fixed-tab-2">
		<div class="page-content"><!-- Your content goes here -->

			<div class="mdl-grid">
			<!-- Graph -->
			<div class="mdl-card mdl-cell--8-col-desktop mdl-cell--6-col-tablet mdl-shadow--3dp"  >
			<div class="mdl-card__title">
				<h2 class="mdl-card__title-text">Graph</h2>
			</div>
			<div class="plotlyGraph" id="plotlyDiv">
			</div>
			<div class="mdl-grid">
				<div class="mdl-cell mdl-cell--3-col-desktop mdl-cell--2-col-tablet">    
					<label id="pacesw" class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="pacechk">
					<input type="checkbox" id="pacechk" onclick="visualize()" class="mdl-checkbox__input">
					<span class="mdl-checkbox__label"></span>
					</label> Pace
					<span for="pacesw" class="mdl-tooltip">Display/hide pace trend.</span>
				</div>
				<div class="mdl-cell mdl-cell--3-col-desktop mdl-cell--2-col-tablet">    
					<label id="elevsw" class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="elevchk">
					<input type="checkbox" id="elevchk" onclick="visualize()" class="mdl-checkbox__input">
					<span class="mdl-checkbox__label"></span>
					</label> Elevation
					<span for="elevsw" class="mdl-tooltip">Display/hide elevation trend.</span>
				</div>
				<div class="mdl-cell mdl-cell--3-col-desktop mdl-cell--2-col-tablet">    
					<label id="cadsw" class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="cadchk">
					<input type="checkbox" id="cadchk" onclick="visualize()" class="mdl-checkbox__input">
					<span class="mdl-checkbox__label"></span>
					</label>  Cadence
					<span for="cadsw" class="mdl-tooltip">Display/hide cadence trend.</span>
				</div>
				<div class="mdl-cell mdl-cell--3-col-desktop mdl-cell--2-col-tablet">    
					<label id="metricsw" class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="usemetric">
					<input type="checkbox" id="usemetric" onclick="visualize()" class="mdl-checkbox__input" >
					<span class="mdl-checkbox__label"></span>
					</label> Metric
					<span for="metricsw" class="mdl-tooltip">Replot in metric or english unit system.</span>
				</div>
			</div>
			</div>
			
			<!-- Map -->
			<div class="mdl-card mdl-cell--4-col-desktop mdl-cell--2-col-tablet mdl-shadow--3dp">
				<div class="mdl-card__title">
					<h2 class="mdl-card__title-text">Map</h2>
				</div>
				<div class="google-map" id="mapDiv">
				</div>
			</div>
		</div>

		</div>

		<footer class="mdl-mini-footer">
		<div class="mdl-mini-footer__left-section">
			<div class="mdl-logo">
			More Information
			</div>
			<ul class="mdl-mini-footer__link-list">
			<li><a target="_blank" href="/static/help.html">Help</a></li>
			<li><a target="_blank" href="/static/help.html#license">License</a></li>
			</ul>
		</div>
		<div class="mdl-mini-footer__right-section">
		<!--
			<button class="mdl-mini-footer__social-btn"></button>
			<button class="mdl-mini-footer__social-btn"></button>
			<button class="mdl-mini-footer__social-btn"></button>
		-->
		</div>
		</footer>
	</section>
	<section class="mdl-layout__tab-panel" id="fixed-tab-3">
		<div class="page-content"><!-- Your content goes here -->


			<div class="mdl-grid">
			<!-- Race performance -->
			<div class="mdl-card mdl-cell--6-col-desktop mdl-cell--4-col-tablet mdl-shadow--3dp">
				<div class="mdl-card__title">
					<h2 class="mdl-card__title-text">Equivalent Race Performances</h2>
				</div>
				<div class="google-table" id="prediction_div">
				</div>
			</div>

			<!-- Analysis -->
			<div class="mdl-card mdl-cell--6-col-desktop mdl-cell--4-col-tablet mdl-shadow--3dp">
				<div class="mdl-card__title">
					<h2 class="mdl-card__title-text">Analysis</h2>
				</div>
				<div class="mdl-card__subtitle-text">
				Calculate this run's intensity relative to your race performance.
				</div>
				<div class="mdl-grid">
					<div class="mdl-cell mdl-cell--6-col-desktop mdl-cell--4-col-tablet"> 
						<div class="mdl-card__subtitle-text">
						Enter values for a recent race.
						</div>
						<form action="#">
							<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
							<input class="mdl-textfield__input" type="text" pattern="-?[0-9]*(\.[0-9]+)?" onchange="requestData()" id="racedist" value="5000.0">
							<label class="mdl-textfield__label" for="racedist">Distance(m)</label>
							<span class="mdl-textfield__error">Input is not a number!</span>
							</div>
						<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" pattern="-?[0-9]*([0-9]+)?" onchange="analyze()" id="racehours" value="0">
						<label class="mdl-textfield__label" for="racehours">Finish time(hr):</label>
						<span class="mdl-textfield__error">Input is not a number!</span>
						</div>
						<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" pattern="-?[0-9]*([0-9]+)?" onchange="analyze()" id="racemins" value="25">
						<label class="mdl-textfield__label" for="racemins">Finish time(min):</label>
						<span class="mdl-textfield__error">Input is not a number!</span>
						</div>
						<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" pattern="-?[0-9]*([0-9]+)?" onchange="analyze()" id="racesecs" value="0">
						<label class="mdl-textfield__label" for="racesecs">Finish time(secs):</label>
						<span class="mdl-textfield__error">Input is not a number!</span>
						</div>
					</div>
					<div class="mdl-cell mdl-cell--6-col-desktop mdl-cell--4-col-tablet"> 
						<div class="mdl-card__subtitle-text">
						What are my results for this run?
						</div>
							<div id="run_support">
							</div> 
							<div id="run_score_div">
							</div>
							</div>
						</form>
						</div>
				<div class="mdl-card__subtitle-text">
				<a target="_blank" href="/static/help.html#interpreting-results">How do I interpet these results?</a>
				</div>
				</div>
		</div> 

		</div>

		<footer class="mdl-mini-footer">
		<div class="mdl-mini-footer__left-section">
			<div class="mdl-logo">
			More Information
			</div>
			<ul class="mdl-mini-footer__link-list">
			<li><a target="_blank" href="/static/help.html">Help</a></li>
			<li><a target="_blank" href="/static/help.html#license">License</a></li>
			</ul>
		</div>
		<div class="mdl-mini-footer__right-section">
		<!--
			<button class="mdl-mini-footer__social-btn"></button>
			<button class="mdl-mini-footer__social-btn"></button>
			<button class="mdl-mini-footer__social-btn"></button>
		-->
		</div>
		</footer>

	</section>
  </main>
</div>





  </body>
</html>

